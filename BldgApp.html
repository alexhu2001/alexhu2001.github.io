<script>
  const params = new URLSearchParams(window.location.search);
  const bldg = params.get("bldg") || "7352";
  document.getElementById("title").innerText = "Monthly Usage for Home " + bldg;

  // Helper to parse header dates like "5/1/2024"
  function parseHeaderDate(s) {
    const parts = s.split("/");
    if (parts.length === 3) {
      const [m, d, y] = parts.map(p => parseInt(p, 10));
      return new Date(y, m - 1, d);
    }
    return new Date(s);
  }

  d3.csv("DataSummary.csv").then(function(data) {
    // All column names
    const headers = data.columns;
    // Skip the first column ("dataid/date")
    const dateCols = headers.slice(1);

    // Find the row for this home
    const row = data.find(d => String(d["dataid/date"]).trim() === String(bldg));
    if (!row) {
      document.getElementById("chart").innerText = "No data for " + bldg;
      return;
    }

    // Build arrays of dates and values
    const x = [];
    const y = [];
    dateCols.forEach(col => {
      const val = row[col];
      if (val && val.trim() !== "") {
        x.push(parseHeaderDate(col));
        y.push(+val);
      }
    });

    if (x.length === 0) {
      document.getElementById("chart").innerText = "No values found for " + bldg;
      return;
    }

    const trace = {
      x: x,
      y: y,
      type: "scatter",
      mode: "lines+markers",
      name: "kWh"
    };

    const layout = {
      title: "Monthly Consumption",
      xaxis: { title: "Month", type: "date" },
      yaxis: { title: "kWh" }
    };

    Plotly.newPlot("chart", [trace], layout);
  });
</script>
